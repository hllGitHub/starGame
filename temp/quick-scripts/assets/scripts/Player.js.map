{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","jumpAudio","AudioClip","setJumpAction","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","callback","callFunc","playJumpSound","repeatForever","sequence","audioEngine","playEffect","getCenterPos","centerPos","node","x","y","height","startMoveAt","pos","enabled","xSpeed","setPosition","runAction","stopMove","stopAllActions","onLoad","accLeft","accRight","minPosX","parent","width","maxPosX","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","event","keyCode","KEY","a","d","update","dt","Math","abs","onDescroy","off"],"mappings":"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","file":"Player.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // 主角跳跃高度\n        jumpHeight: 0,\n        // 主角跳跃时间\n        jumpDuration: 0,\n        // 最大移动速度\n        maxMoveSpeed: 0,\n        // 加速度\n        accel: 0,\n        // 跳跃音效资源\n        jumpAudio: cc.AudioClip\n    },\n\n    setJumpAction: function() {\n        // 跳跃上升\n        var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut());\n        // 下落\n        var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionOut());\n        // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\n        var callback = cc.callFunc(this.playJumpSound, this);\n        return cc.repeatForever(cc.sequence(jumpUp, jumpDown, callback))\n    },\n\n    playJumpSound: function() {\n        // 调用声音引擎播放声音\n        cc.audioEngine.playEffect(this.jumpAudio, false)\n    },\n\n    getCenterPos: function () {\n        var centerPos = cc.v2(this.node.x, this.node.y + this.node.height/2);\n        return centerPos;\n    },\n\n    startMoveAt: function (pos) {\n        this.enabled = true\n        this.xSpeed = 0\n        this.node.setPosition(pos)\n        this.node.runAction(this.setJumpAction())\n    },\n\n    stopMove: function () {\n        this.node.stopAllActions();\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad: function() {\n        //  this.startGame()\n        this.enabled = false\n        // 加速度方向开关\n        this.accLeft = false\n        this.accRight = false\n        // 主角当前水平方向速度\n        this.xSpeed = 0\n        this.minPosX = -this.node.parent.width/2;\n        this.maxPosX = this.node.parent.width/2;\n\n        // // 初始化键盘监听\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);  \n        \n    },\n\n    onKeyDown(event) {\n        switch(event.keyCode) {\n            case cc.KEY.a:\n                this.accLeft = true\n                break;\n            case cc.KEY.d:\n                this.accRight = true\n                break\n        }\n    },\n\n    // Demo里使用的是cc.macro.Key.a，这是低版本的用法，现在统一使用cc.Key.a\n    onKeyUp(event) {\n        switch(event.keyCode) {\n            case cc.KEY.a:\n                this.accLeft = false\n                break\n            case cc.KEY.d:\n                this.accRight = false\n                break\n        }\n    },\n\n    update: function (dt) {\n        if (this.accLeft) {\n            this.xSpeed  -= this.accel * dt;\n        } else if (this.accRight) {\n            this.xSpeed += this.accel * dt;\n        }\n\n        // 限制主角的速度不能超过最大值\n        if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\n        }\n\n        // 根据当前速度更新主角的位置\n        this.node.x += this.xSpeed * dt;\n\n        // limit player position inside screen\n        if ( this.node.x > this.node.parent.width/2 ) {\n            this.node.x = this.node.parent.width/2;\n            this.xSpeed = 0;\n        } else if ( this.node.x < -this.node.parent.width/2 ){\n            this.node.x = -this.node.parent.width/2;\n            this.xSpeed = 0\n        }\n    },\n\n    onDescroy() {\n        // 取消键盘输入监听\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this)\n        cc.systemEvent.off(cc.systemEvent.EventType.KEY_UP, this.onKeyUp, this)\n    }\n});\n"]}